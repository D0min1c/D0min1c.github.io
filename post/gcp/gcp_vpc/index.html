<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#1b1b1b"><title>Network 기초(VPC) - GCP | 255.255.248.0</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><meta property="og:title" content="Network 기초(VPC) - GCP"><meta property="og:description" content="GCP VPC를 처음 겪어보는 당신에게 추천합니다."><meta property="og:type" content="article"><meta property="og:url" content="https://21sub.net/post/gcp/gcp_vpc/"><meta itemprop=name content="Network 기초(VPC) - GCP"><meta itemprop=description content="GCP VPC를 처음 겪어보는 당신에게 추천합니다."><meta itemprop=wordCount content="594"><meta itemprop=keywords content="gcp,public cloud,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Network 기초(VPC) - GCP"><meta name=twitter:description content="GCP VPC를 처음 겪어보는 당신에게 추천합니다."><link rel=stylesheet href=/css/bundle.css><link rel=stylesheet href=/css/custom.css><link rel=icon href=/icons/16.png sizes=16x16 type=image/png><link rel=icon href=/icons/32.png sizes=32x32 type=image/png><link rel=manifest href=/manifest.json><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-199142344-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="body kind-page"><header class=header><a class=logo href=/>255.255.248.0</a><nav class="main-nav main-nav--right" role=navigation><button id=toggle class=main-nav__btn aria-label="Menu toggle" aria-expanded=false tabindex=0><div class=main-nav__btn-box tabindex=-1><svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18"><path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/><path class="icon-menu__x" d="M11.55 9 18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55.0 9 6.45 15.45.0 18 2.55 11.55 9z"/></svg></div></button><ul id=menu class=main-nav__list><li class=main-nav__item><a class=main-nav__link href=/about_dominic/><span class=main-nav__text>About Dominic</span></a></li><li class=main-nav__item><a class=main-nav__link href=/post/certificate/aws-saa/><span class=main-nav__text>AWS Certified Solutions Architect – Associate</span></a></li><li class=main-nav__item><a class=main-nav__link href=/awskrug/><span class=main-nav__text>AWSKRUG-Beginner</span></a></li></ul></nav></header><div class=primary><main class=main><nav class="breadcrumb block" aria-label=breadcrumb><ol class=breadcrumb__list><li class=breadcrumb__item><a class=breadcrumbs__link href=/>21sub.net</a></li><li class=breadcrumb__item><a class=breadcrumbs__link href=/post/>Posts</a></li><li class="breadcrumbs__item breadcrumb__item--active" aria-current=page>Network 기초(VPC) - GCP</li></ol></nav><div class="single block"><article class=entry><div class="entry__meta meta mb"><span class="entry__meta-categories meta-categories"><span class=meta-categories__list>Categories:
<a class=meta-categories__link href=/categories/gcp/ rel=category>GCP</a></span></span></div><h1 class=entry__title>Network 기초(VPC) - GCP</h1><div class=entry__content><p>GCP VPC를 처음 겪어보는 당신에게 추천합니다.</p><h2 id=배경>배경</h2><p>GCP를 통해 클라우드를 입문하셨거나, AWS를 사용하다가 GCP로 넘어오신 분들, 갑작스런 변화에 살짝 오잉? 하셨을겁니다.</p><p>저는 저만의 오잉 포인트들을 모아서 기록해두었습니다. 고고</p><h2 id=gcp의-vpc-virtual-private-cloud>GCP의 VPC (Virtual private cloud)</h2><p>GCP의 VPC에 대해 우선 짚어봅시다.</p><p>VPC (Virtual private cloud)란, 간단하게 클라우드 환경 상의 논리적으로 격리된 개개인의 사설 네트워크 망을 말합니다.</p><p>보통 AWS의 인프라 환경은 굉장히 계층적인 구조를 보여줍니다.</p><p>가령, 리전(국가) 내에 여러 가용영역(도시)들이 있으며 가용영역들은 1개이상의 개별 데이터센터로 구축되어있습니다.</p><p>또한 가용영역 간 동기복제를 수행하기 떄문에 사용자는 여러 리전, 가용영역들에 애플리케이션을 배포함으로써 고가용성의 이점을 얻을 수 있습니다.</p><p>들어가기 앞서 기본적으로 AWS GCP의 공통사항을 먼저 다루자면</p><p>서브넷에 이미 AWS(GCP)에서 예약해놓은 IP 주소들이 있다는 점</p><p>x.x.x.0 , x.x.x.1, x.x.x.254, x.x.x.255</p><hr><h2 id=구조적-차이를-이해하자>구조적 차이를 이해하자!</h2><p>![This is an image](/img/ aws_vpc.jpg)</p><p>AWS는 말그대로 계층적인 구조를 가지고 있습니다.</p><ul><li><strong>Virtual Private Cloud(VPC)</strong> — 사용자의 AWS 계정 전용 가상 네트워크입니다.</li><li><strong>서브넷</strong> — VPC의 IP 주소 범위입니다.</li><li><strong>라우팅 테이블</strong> — 네트워크 트래픽을 전달할 위치를 결정하는 데 사용하는 라우팅이라는 이름의 규칙 집합입니다.</li><li><strong>인터넷 게이트웨이</strong> — VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 게이트웨이입니다.</li></ul><p>VPC는 리전에 연결되어 Cidr값을 지정하고 Cidr값을 subnetting하여 각 가용영역에 지정합니다.(인스턴스를 생성해야하니까요!?)</p><p>근데 GCP는 그렇지 않습니다. 애초부터 VPC가 리전에 종속되지 않습니다.</p><p><img src=/img/gcp_vpc.jpg alt="This is an image"></p><p>GCP의 VCP는 특정 가용영역과 리전에 종속되지 않는 전역 리소스입니다. GCP에서의 전역리소스는 동일 프로젝트 내의 모든 영역에 있는 모든 리소스가 엑세스 할 수 있다는 뜻입니다.</p><ul><li><strong>Virtual Private Cloud(VPC)</strong> — 사용자의 GCP 계정 전용 가상 네트워크입니다.</li><li><strong>서브넷</strong> — <del>VPC의 IP 주소 범위입니다.</del> 아닙니다. 각 가용영역 (GCP에선 zone)의 대역입니다.</li><li><strong>라우팅 테이블</strong> — 네트워크 트래픽을 전달할 위치를 결정하는 데 사용하는 라우팅이라는 이름의 규칙 집합입니다.</li><li><strong>인터넷 게이트웨이</strong> — VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 게이트웨이입니다.</li></ul><p>AWS에서 도쿄리전과 서울리전의 각각의 인스턴스를 두고 있고 서로 통신이 필요할 경우, 별도의 분리된 VPC 간의 통신을 지원할 무언가가 필요한 상황입니다.</p><p>그러나, GCP의 서브넷이 리전에 연결되기에 단지 내부 라우팅을 열어줌으로써 도쿄 리전의 인스턴스와 서울리전의 인스턴스가 통신이 가능하게 된다는 말입니다.</p><p>VPC는 리전에 종속되지 않습니다. VPC 내 서브넷들이 각 리전에 연결되어 Cidr값을 지정하고 Routing Table, Firewall rule에 따라 트래픽의 흐름을 보여줍니다.</p><h2 id=차이를-하나만-더보자면-아마-피어링--vpc-peering>차이를 하나만 더보자면 아마 피어링 ? (VPC Peering)</h2><p>각 벤더에서 VPC 간 트래픽을 라우팅 하고자할때 위와같은 특성에 의해 고려해야될 부분들이 갈린다.</p><h3 id=aws는-동일-리전의-vpc-간-peering-계정-간-vpc-peering-리전간-vpc-peering으로-나뉜다>AWS는 동일 리전의 VPC 간 peering, 계정 간 VPC peering, 리전간 VPC peering으로 나뉜다.</h3><p>이때 3가지 방법 모두 라우팅 테이블에 peering connect를 만들어 서로 본인의 사설 Cidr 값을 라우팅으로 추가해주어야 합니다.</p><h3 id=gcp는-서로다른-organization-project-간-vpc--피어링만-고민하면된다>GCP는 서로다른 Organization, project 간 VPC 피어링만 고민하면된다.</h3><p>리전 간 통신은 위 설명대로 방화벽으로 제어하며, 방화벽 상에서 서로의 서브넷을 ingress, Egress로 추가한 네트워크 태그를 인스턴스에 추가하여 허용할 수 있기 때문에 서로 다른 Org 간 혹은 Project 간의 Priavte 통신이 필요한 경우에만 고려하면 됩니다.</p><h2 id=vpc-peering을-고려한다면-aws든-gcp든-subnet을-겹치게-생성하지-말자>VPC peering을 고려한다면 AWS든 GCP든 subnet을 겹치게 생성하지 말자.</h2><p>중요합니다. 만약 AWS든 GCP든 VPC를 분리하여 사용하고자 할 때 (가령 중앙화나 로그수집에 대한 인프라 구축, VPN 등) 서브넷의 대역이 겹쳐 피어링을 맺지 못한다면 Public IP 간 통신을 해야합니다. 트래픽이 Global 망을 타고 나갔다 들어오기 떄문에 보안적으로도 비용적으로도 성능적으로도 좋지 못한 구성이기 때문입니다. <del>(어쩔수 없으면 쓸 수 밖에 없겠네요 저같이..)</del></p><p>대역이 겹치는 이슈 이외에도 몇가지 제한되는 사항들이 있는데, 이는 각 벤더 문서에서 VPC peering을 검색해보면 됩니다.</p><p>아래는 공통적으로 제한되는 부분에 대해서만 서술해두었습니다.</p><h3 id=제한사항>제한사항</h3><ul><li><p>피어링된 한 VPC 네트워크의 서브넷 CIDR 범위는 다른 피어링된 네트워크의 대역과 겹칠 수 없습니다.</p><ul><li>제.곧.내 (제목이 곧 내용)</li></ul></li><li><p>직접 피어링된 VPC끼리만 통신이 가능합니다.</p><ul><li><p>가령 A, B, C VPC가 있다고 가정하였을때, A &lt;-> B 사이에 peering을 구성해놓고, 이후 B&lt;->C의 피어링을 맺으면 중간의 B VPC가 마치 Hub의 역할을 하여 A&lt;->C도 connection이 이뤄진다고 생각할 수 있습니다.</p><p>결론부터 말하자면 불가능합니다.</p><p>VPC peering의 connection은 각각 독립적인 Connection이기에 위와같은 구조를 원한다면 AWS Trangit Gateway를 통하거나,
처음부터 B&lt;->C의 peering을 설정하면 되는 문제입니다.</p></li></ul></li><li><p>제한사항은 아니지만 보통 피어링이 성공적으로 Connection됬는데 서버 간 통신이 안되면 당연히 라우팅 확인과 서버의 보안그룹(방화벽)등을 확인해야합니다.</p></li></ul><p>GCP VPC와 나아가 Network Peering에 대해 간단하게 풀어봤습니다.</p><p>감사합니다.</p></div><footer class=entry__footer><div class=entry__tags><a class="entry__tag btn" href=/tags/gcp/>gcp</a>
<a class="entry__tag btn" href=/tags/public-cloud/>public cloud</a></div></footer></article></div></main><div class="authorbox block"><div class=author><figure class=author__avatar><img class=author__img alt="Dominic avatar" src=/img/avatar.png height=90 width=90></figure><div class=author__body><div class=author__name>Dominic</div><div class=author__bio>Dominic's true identity is unknown. Maybe he is a cute fairy or slave :D</div></div></div></div><div class="related block"><h3 class=related__title>Related</h3><ul class=related__list><li class=related__item><a class=related__link href=/post/gcp/gcp_clb_1/>GCP-Cloud Load Balancer(1) 내용정리</a></li><li class=related__item><a class=related__link href=/post/gcp/gcp_clb_2/>GCP-Cloud Load Balancer(2) 테스트</a></li><li class=related__item><a class=related__link href=/post/gcp/gcp_issue/>아니 글쎄 갑자기 인스턴스가 죽었다니까요? - GCP</a></li><li class=related__item><a class=related__link href=/post/certificate/aws-saa/>AWS Certified Solutions Architect – Associate</a></li><li class=related__item><a class=related__link href=/post/aws/aws_issue/>아니 글쎄 갑자기 인스턴스가 죽었다니까요? - AWS</a></li></ul></div><section class="comments block"><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dominic"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><footer class=footer><div class="footer__social social"><a class=social__link target=_blank rel="noopener noreferrer" href=https://www.instagram.com/seob.199b><svg class="social__icon" aria-label="Instagram" role="img" width="32" height="32" viewBox="0 0 512 512"><g fill="none" stroke-width="29"><rect height="296" rx="78" width="296" x="108" y="108"/><circle cx="256" cy="256" r="69"/></g><circle cx="343" cy="169" r="19"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://linkedin.com/in/hanseob-lee-9655781aa><svg class="social__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://github.com/D0min1c><svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg></a></div><div class=footer__copyright>© 2021 Binario. <span class=footer__copyright-credits>Powered by <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/vimux/binario rel="nofollow noopener" target=_blank>Binario</a> theme.</span></div></footer><script src=/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script><script src=/js/custom.js></script></body></html>