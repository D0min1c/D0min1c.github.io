<!doctype html><html><head><title>k8s(Networking)</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/favicon_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG><meta property="og:title" content="k8s(Networking)"><meta property="og:description" content="Sample post with multiple images, embedded video ect."><meta property="og:type" content="article"><meta property="og:url" content="https://hugo-toha.github.io/posts/certification/cka/k8snetworking/"><meta property="article:published_time" content="2020-06-19T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-19T00:00:00+00:00"><meta name=description content="Sample post with multiple images, embedded video ect."><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG alt=Logo>
255.255.248.0</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/>Certification</a><ul class=active><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/cka/>CKA</a><ul class=active><li><a href=/posts/certification/cka/k8scomponent/ title=k8s(component)>k8s(component)</a></li><li><a href=/posts/certification/cka/k8sgke%EC%82%AC%EC%9A%A9%EA%B8%B0/ title=k8s(GKE사용기)>k8s(GKE사용기)</a></li><li><a class=active href=/posts/certification/cka/k8snetworking/ title=k8s(Networking)>k8s(Networking)</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/>Cloud</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/aws/>AWS</a><ul><li><a href=/posts/cloud/aws/awshost_issue/ title="서버가 갑자기 박살나셨습니다. -AWS">서버가 갑자기 박살나셨습니다. -AWS</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/gcp/>GCP</a><ul><li><a href=/posts/cloud/gcp/gcphost_issue/ title="서버가 갑자기 박살나셨습니다. -GCP">서버가 갑자기 박살나셨습니다. -GCP</a></li></ul></li></ul></li><li><a href=/posts/about_dominic/ title=😎About_dominic😎>😎About_dominic😎</a></li><li><a href=/posts/shortcodes/ title="Shortcodes Sample">Shortcodes Sample</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://hugo-toha.github.io/posts/certification/cka/k8snetworking/images/CKA_thumnail.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/dominic_hue8656283646074d0d4d459b13fee860e_56605_120x120_fit_box_2.png alt="Author Image"><h5 class=author-name>dominic</h5><p>June 19, 2020</p></div><div class=title><h1>k8s(Networking)</h1></div><div class=post-content id=post-content><p>CKA 취득을 위해 이론적으로 공부한 내용들을 간단하게 기록하였습니다.</p><h2 id=배경>배경</h2><p>컨테이너 Network부터 Pod Network까지 이론정리</p><h3 id=docker-networking>Docker Networking</h3><ul><li>격리된 환경에서 실행되는 하나의 <strong>프로세스</strong></li><li>위에서 격리된 환경을 구현하는 기술은 chroot, cgroups, namespace<ul><li>namespace : 네트워크인터페이스, 라우팅, 방화벽 규칙들을 격리한다. 이런 namespace로 인해 격리된 PID들은 veth를 통해 연결한다.</li><li>veth : linked virtual ethernet device pair = 항상 쌍 (pair)로 생성되어 연결된 상태를 유지한다.</li></ul></li></ul><p>직접 Namespace를 생성해보자.</p><p><img src=images/ns_1.jpg alt="This is an image"></p><p>local namespace와 ipnetns add를 통해 만든 namespace에 veth를 붙여봤다.</p><p>컨테이너를 새로이 배포할때마다 컨테이너에게 veth0라는 가상 네트워크 인터페이스를 할당하여 docker0에 연결,
linked virtual ethernet device pair로 컨테이너와 bridge를 연결한다.</p><p><img src=images/docker_info.jpg alt="This is an image"></p><ul><li>도커 설치 직후 상태</li></ul><h4 id=bridge-network>bridge Network</h4><p>결국 컨테이너 네트워크 인터페이스 (Namesapce 내 veth)들은 bridge(docker0 : docker 시작시 기본적으로 생성되는 bridge)를 통해 연결되어 하나의 세그먼트로 구성되지만, 같은 bridge에 연결되지 않은 컨테이너들은 격리된 공간을 유지한다.</p><p><strong>[eth0 -> docker0(bridge) -> veth0(host) &lt;-[pairing]-> veth0(container) -> container]</strong></p><p><img src=images/docker_brg.jpg alt="This is an image"></p><p>위 이미지에서 bridge의 subnet과 Gateway를 보고 밑에 container의 IP를 보면 확실하다.</p><p>아니면 brctl show 명령어를 통해 bridge에 연결되어있는 Interface에 veth를 확인하면 된다.</p><p>default bridge 말고, custom bridge를 생성하여 별도의 네트워크 구성도 물론 가능하다고 하지만, 해보진 않았으므로 잠시 미뤄두겠다.</p><h4 id=host-networking>Host Networking</h4><p><img src=images/docker_hst.jpg alt="This is an image"></p><p>Host에서 사용하고 있는 네트워크를 그대로 컨테이너가 사용한다.</p><p>그렇기 떄문에 컨테이너에 IP(veth)를 할당하지 않기에 bridge에 바인딩이 되지 않는다.</p><h4 id=overlay-networking>overlay Networking</h4><p>다른 도커 데몬 host의 container와 통신하기 위해 보통 OS레벨에서의 라우팅이 필요하지만, Overlay 네트워크를 사용하여 분산 네트워크(arg. Swarm service)를 구성할 수 있다.</p><h4 id=none-networking>none Networking</h4><p>none : 모든 네트워킹 드라이버, 그 어떠한 인터페이스도 없는 설정이다. 보통 커스텀 네트워크 드라이버를 구성할 경우 사용한다.</p><h4 id=macvlan-ipvlan-networking>macvlan, ipvlan Networking</h4><p>말그대로 가상 mac주소를 할당하여 물리적 호스트처럼 보이도록 설정하거나, L2,L3 모드가 필요할 때 사용한다.</p><h3 id=k8s-networking>k8s Networking</h3><h4 id=pod-networking>Pod Networking</h4><p>Container Network에서 설명했듯이, 각각의 컨테이너는 독립적인 namesapce를 통해 격리되어진다.</p><p>여기서 k8s의 Pods의 개념이 들어가면 같은 pod의 컨테이너들은 Network namespace를 공유한다.(컨테이너가 N개여도 veth는 1개) 그렇기에 동일한 IP를 사용한다.</p><p>따라서 lookback 인터페이스를 통해 localhost+port 통신이 가능하다.</p><p>이 Pod 내 컨테이너들의 Namespace를 공유해주는게 바로 pause 컨테이너이다.</p><p>CNI를 어떤걸 선택해는지에 따라 네트워크 구성과 성능이 달라지기에 Pods Network까지만 정리해놓는다.</p></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#배경>배경</a><ul><li><a href=#docker-networking>Docker Networking</a><ul><li><a href=#bridge-network>bridge Network</a></li><li><a href=#host-networking>Host Networking</a></li><li><a href=#overlay-networking>overlay Networking</a></li><li><a href=#none-networking>none Networking</a></li><li><a href=#macvlan-ipvlan-networking>macvlan, ipvlan Networking</a></li></ul></li><li><a href=#k8s-networking>k8s Networking</a><ul><li><a href=#pod-networking>Pod Networking</a></li></ul></li></ul></li></ul></nav></div></div></section></div><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>