<!doctype html><html><head><title>Google Cloud Network 기초</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/favicon_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG><meta property="og:title" content="Google Cloud Network 기초"><meta property="og:description" content="Sample post with multiple images, embedded video ect."><meta property="og:type" content="article"><meta property="og:url" content="https://hugo-toha.github.io/posts/cloud/gcp/gcpnetwork-1/"><meta property="article:published_time" content="2021-06-24T00:00:00+00:00"><meta property="article:modified_time" content="2021-06-24T00:00:00+00:00"><meta name=description content="Sample post with multiple images, embedded video ect."><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-199142344-2','auto');ga('send','pageview');}</script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG alt=Logo>
255.255.248.0</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/certification/>Certification</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/certification/cka/>CKA</a><ul><li><a href=/posts/certification/cka/k8scomponent/ title=k8s(component)>k8s(component)</a></li><li><a href=/posts/certification/cka/k8sgke%EC%82%AC%EC%9A%A9%EA%B8%B0-1/ title=k8s(GKE-Pod)>k8s(GKE-Pod)</a></li><li><a href=/posts/certification/cka/k8sgke%EC%82%AC%EC%9A%A9%EA%B8%B0-2/ title=k8s(GKE-Service)>k8s(GKE-Service)</a></li><li><a href=/posts/certification/cka/k8singress/ title=k8s(Ingress)>k8s(Ingress)</a></li><li><a href=/posts/certification/cka/k8snetworking/ title=k8s(Networking)>k8s(Networking)</a></li></ul></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/cloud/>Cloud</a><ul class=active><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/aws/>AWS</a><ul><li><a href=/posts/cloud/aws/awshost_issue/ title="AWS이슈 (Host error)">AWS이슈 (Host error)</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/cloud/gcp/>GCP</a><ul class=active><li><a href=/posts/cloud/gcp/gcpissue/ title="GCP 이슈(리소스 부족 등)">GCP 이슈(리소스 부족 등)</a></li><li><a class=active href=/posts/cloud/gcp/gcpnetwork-1/ title="GCP-VPC 기초 1편">GCP-VPC 기초 1편</a></li><li><a href=/posts/cloud/gcp/gcpnetwork-2/ title="GCP-VPC 기초 2편">GCP-VPC 기초 2편</a></li></ul></li></ul></li><li><a href=/posts/about_dominic/ title=😎About_dominic😎>😎About_dominic😎</a></li><li><a href=/posts/shortcodes/ title="Shortcodes Sample">Shortcodes Sample</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://hugo-toha.github.io/posts/cloud/gcp/gcpnetwork-1/images/gcp_vpc.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/dominic_hue8656283646074d0d4d459b13fee860e_56605_120x120_fit_box_2.png alt="Author Image"><h5 class=author-name>dominic</h5><p>June 24, 2021</p></div><div class=title><h1>Google Cloud Network 기초</h1></div><div class=post-content id=post-content><p>제목은 GCP VPC에 대해서 메모라고 하겠습니다. 이제 약간 AWS VPC를 곁들인..</p><h2 id=배경>배경</h2><p>GCP를 통해 클라우드를 입문하셨거나, AWS를 사용하다가 GCP로 넘어오신 분들, 갑작스런 변화에 살짝 오잉? 하셨을겁니다.</p><p>저는 저만의 오잉 포인트들을 모아서 기록해두었습니다. 고고</p><h3 id=gcp의-vpc-virtual-private-cloud>GCP의 VPC (Virtual private cloud)</h3><p>GCP의 VPC에 대해 우선 짚어봅시다.</p><p>VPC (Virtual private cloud)란, 간단하게 클라우드 환경 상의 논리적으로 격리된 개개인의 사설 네트워크 망을 말합니다.</p><p>보통 AWS의 인프라 환경은 굉장히 계층적인 구조를 보여줍니다.</p><p>가령, 리전(국가) 내에 여러 가용영역(도시)들이 있으며 가용영역들은 1개이상의 개별 데이터센터로 구축되어있습니다.</p><p>또한 가용영역 간 동기복제를 수행하기 떄문에 사용자는 여러 리전, 가용영역들에 애플리케이션을 배포함으로써 고가용성의 이점을 얻을 수 있습니다.</p><p>들어가기 앞서 기본적으로 AWS GCP의 공통사항을 먼저 다루자면</p><p>서브넷에 이미 AWS(GCP)에서 예약해놓은 IP 주소들이 있다는 점 참고해주세요.</p><p>x.x.x.0 / x.x.x.1 / x.x.x.254 / x.x.x.255</p><hr><h3 id=구조적-차이를-이해하자>구조적 차이를 이해하자!</h3><p><img src=images/aws_vpc.jpg alt="This is an image"></p><p>AWS는 말그대로 계층적인 구조를 가지고 있습니다.</p><ul><li><strong>Virtual Private Cloud(VPC)</strong> — 사용자의 AWS 계정 전용 가상 네트워크입니다.</li><li><strong>서브넷</strong> — VPC의 IP 주소 범위입니다.</li><li><strong>라우팅 테이블</strong> — 네트워크 트래픽을 전달할 위치를 결정하는 데 사용하는 라우팅이라는 이름의 규칙 집합입니다.</li><li><strong>인터넷 게이트웨이</strong> — VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 게이트웨이입니다.</li></ul><p>VPC는 리전에 연결되어 Cidr값을 지정하고 Cidr값을 subnetting하여 각 가용영역에 지정합니다.(인스턴스를 생성해야하니까요!?)</p><p>GCP는 다릅니다. 애초부터 VPC가 리전에 종속되지 않습니다.</p><p><img src=images/gcp_vpc.jpg alt="This is an image"></p><p>GCP의 VCP는 특정 가용영역과 리전에 종속되지 않는 전역 리소스입니다. GCP에서의 전역리소스는 동일 프로젝트 내의 모든 영역에 있는 모든 리소스가 엑세스 할 수 있다는 뜻입니다.</p><ul><li><strong>Virtual Private Cloud(VPC)</strong> — 사용자의 GCP 계정 전용 가상 네트워크입니다.</li><li><strong>서브넷</strong> — <del>VPC의 IP 주소 범위입니다.</del> 아닙니다. 각 가용영역 (GCP에선 zone)의 대역입니다.</li><li><strong>라우팅 테이블</strong> — 네트워크 트래픽을 전달할 위치를 결정하는 데 사용하는 라우팅이라는 이름의 규칙 집합입니다.</li><li><strong>인터넷 게이트웨이</strong> — VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 게이트웨이입니다.</li></ul><p>AWS에서 도쿄리전과 서울리전의 각각의 인스턴스를 두고 있고 서로 통신이 필요할 경우, 별도의 분리된 VPC 간의 통신을 지원할 무언가가 필요한 상황입니다.</p><p>그러나, GCP의 서브넷이 리전에 연결되기에 단지 내부 라우팅을 열어줌으로써 도쿄 리전의 인스턴스와 서울리전의 인스턴스가 통신이 가능하게 된다는 말입니다.</p><p>VPC는 리전에 종속되지 않습니다. VPC 내 서브넷들이 각 리전에 연결되어 Cidr값을 지정하고 Routing Table, Firewall rule에 따라 트래픽의 흐름을 보여줍니다.</p><p>VM의 중단없이 Subnet의 확장이 가능합니다.</p><h3 id=차이를-하나만-더보자면-아마-피어링--vpc-peering>차이를 하나만 더보자면 아마 피어링 ? (VPC Peering)</h3><p>각 벤더에서 VPC 간 트래픽을 라우팅 하고자할때 위와같은 특성에 의해 고려해야될 부분들이 있습니다.</p><h3 id=aws는-이래요>AWS는 이래요</h3><p>동일 리전의 VPC 간 peering, 계정 간 VPC peering, 리전간 VPC peering으로 나뉩니다.</p><p>이때 3가지 방법 모두 라우팅 테이블에 peering connect를 만들어 서로 본인의 사설 Cidr 값을 라우팅으로 추가해주어야 합니다.</p><h3 id=gcp는-서로다른-organization-project-간-vpc--피어링만-고민하면된다>GCP는 서로다른 Organization, project 간 VPC 피어링만 고민하면된다.</h3><p>리전 간 통신은 위 설명대로 방화벽으로 제어하며, 방화벽 상에서 서로의 서브넷을 ingress, Egress로 추가한 네트워크 태그를 인스턴스에 추가하여 허용할 수 있기 때문에 서로 다른 Org 간 혹은 Project 간의 Priavte 통신이 필요한 경우에만 고려하면 됩니다.</p><h3 id=vpc-peering을-고려한다면-aws든-gcp든-subnet을-겹치게-생성하지-말자>VPC peering을 고려한다면 AWS든 GCP든 subnet을 겹치게 생성하지 말자.</h3><p>중요합니다. 만약 AWS든 GCP든 VPC를 분리하여 사용하고자 할 때 (가령 중앙화나 로그수집에 대한 인프라 구축, VPN 등) 서브넷의 대역이 겹쳐 피어링을 맺지 못한다면 Public IP 간 통신을 해야합니다. 트래픽이 Global 망을 타고 나갔다 들어오기 떄문에 보안적으로도 비용적으로도 성능적으로도 좋지 못한 구성이기 때문입니다.</p><p>대역이 겹치는 이슈 이외에도 몇가지 제한되는 사항들이 있는데, 이는 각 벤더 문서에서 VPC peering을 검색해보면 됩니다.
가령 미리 예약해둔 4개의 IP (Brodcast IP)등 일반적으로 예약되는 RFC 범위에 대해 제한사항이 있습니다.
<img src=images/gcp_RI.jpg alt="This is an image"></p><p>아래는 공통적으로 제한되는 부분에 대해서만 서술해두었습니다.</p><h3 id=제한사항>제한사항</h3><ul><li><p>피어링된 한 VPC 네트워크의 서브넷 CIDR 범위는 다른 피어링된 네트워크의 대역과 겹칠 수 없습니다.</p><ul><li>제.곧.내 (제목이 곧 내용)</li></ul></li><li><p>직접 피어링된 VPC끼리만 통신이 가능합니다.</p><ul><li><p>가령 A, B, C VPC가 있다고 가정하였을때, A &lt;-> B 사이에 peering을 구성해놓고, 이후 B&lt;->C의 피어링을 맺으면 중간의 B VPC가 마치 Hub의 역할을 하여 A&lt;->C도 connection이 이뤄진다고 생각할 수 있습니다.</p><p>결론부터 말하자면 불가능합니다.</p><p>VPC peering의 connection은 각각 독립적인 Connection이기에 위와같은 구조를 원한다면 AWS Trangit Gateway를 통하거나,
처음부터 B&lt;->C의 peering을 설정하면 되는 문제입니다.</p></li></ul></li><li><p>제한사항은 아니지만 보통 피어링이 성공적으로 Connection이 이뤄졌는데도 불구하고, 서버 간 통신이 안되면 라우팅경로와 서버의 보안그룹(방화벽)등을 확인해야 합니다.</p></li></ul><p>GCP VPC와 나아가 Network Peering에 대해 간단하게 풀어봤습니다.</p><p>추후에는 VPC flow logging과 일명 &ldquo;고급 VPC"에 대해 메모해놓을 예정입니다.</p><p>감사합니다.</p></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#배경>배경</a><ul><li><a href=#gcp의-vpc-virtual-private-cloud>GCP의 VPC (Virtual private cloud)</a></li><li><a href=#구조적-차이를-이해하자>구조적 차이를 이해하자!</a></li><li><a href=#차이를-하나만-더보자면-아마-피어링--vpc-peering>차이를 하나만 더보자면 아마 피어링 ? (VPC Peering)</a></li><li><a href=#aws는-이래요>AWS는 이래요</a></li><li><a href=#gcp는-서로다른-organization-project-간-vpc--피어링만-고민하면된다>GCP는 서로다른 Organization, project 간 VPC 피어링만 고민하면된다.</a></li><li><a href=#vpc-peering을-고려한다면-aws든-gcp든-subnet을-겹치게-생성하지-말자>VPC peering을 고려한다면 AWS든 GCP든 subnet을 겹치게 생성하지 말자.</a></li><li><a href=#제한사항>제한사항</a></li></ul></li></ul></nav></div></div></section></div><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>