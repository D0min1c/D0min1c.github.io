<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#1b1b1b"><title>Hello, Docker 기초! | 255.255.248.0</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><meta property="og:title" content="Hello, Docker 기초!"><meta property="og:description" content="GCP 환경에서 docker를 사용하여 이미지를 빌드하고 실행해보고,
GCR(Google Container Registry)에 게시해봅시다."><meta property="og:type" content="article"><meta property="og:url" content="https://21sub.net/post/gcp/gcp_docker-1/"><meta itemprop=name content="Hello, Docker 기초!"><meta itemprop=description content="GCP 환경에서 docker를 사용하여 이미지를 빌드하고 실행해보고,
GCR(Google Container Registry)에 게시해봅시다."><meta itemprop=wordCount content="569"><meta itemprop=keywords content="gcp,public cloud,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hello, Docker 기초!"><meta name=twitter:description content="GCP 환경에서 docker를 사용하여 이미지를 빌드하고 실행해보고,
GCR(Google Container Registry)에 게시해봅시다."><link rel=stylesheet href=/css/bundle.css><link rel=stylesheet href=/css/custom.css><link rel=icon href=/icons/16.png sizes=16x16 type=image/png><link rel=icon href=/icons/32.png sizes=32x32 type=image/png><link rel=manifest href=/manifest.json><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-199142344-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="body kind-page"><header class=header><a class=logo href=/>255.255.248.0</a><nav class="main-nav main-nav--right" role=navigation><button id=toggle class=main-nav__btn aria-label="Menu toggle" aria-expanded=false tabindex=0><div class=main-nav__btn-box tabindex=-1><svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18"><path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/><path class="icon-menu__x" d="M11.55 9 18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55.0 9 6.45 15.45.0 18 2.55 11.55 9z"/></svg></div></button><ul id=menu class=main-nav__list><li class=main-nav__item><a class=main-nav__link href=/about_dominic/><span class=main-nav__text>About Dominic</span></a></li><li class=main-nav__item><a class=main-nav__link href=/post/certificate/aws-saa/><span class=main-nav__text>AWSKRUG beginner group Study 관련</span></a></li></ul></nav></header><div class=primary><main class=main><nav class="breadcrumb block" aria-label=breadcrumb><ol class=breadcrumb__list><li class=breadcrumb__item><a class=breadcrumbs__link href=/>21sub.net</a></li><li class=breadcrumb__item><a class=breadcrumbs__link href=/post/>Posts</a></li><li class="breadcrumbs__item breadcrumb__item--active" aria-current=page>Hello, Docker 기초!</li></ol></nav><div class="single block"><article class=entry><div class="entry__meta meta mb"><span class="entry__meta-categories meta-categories"><span class=meta-categories__list>Categories:
<a class=meta-categories__link href=/categories/gcp/ rel=category>GCP</a></span></span></div><h1 class=entry__title>Hello, Docker 기초!</h1><div class=entry__content><p>GCP 환경에서 docker를 사용하여 이미지를 빌드하고 실행해보고,</p><p>GCR(Google Container Registry)에 게시해봅시다.</p><h2 id=배경>배경</h2><p>Docker 컨테이너 빌드, 실행과 Docker Hub 및 Google Container Registry에서 Docker 이미지 가져오기</p><p>그리고 Dockerfile을 통해 이미지를 생성하는 법에 대해 간단하게 확인해봤습니다.</p><p>Docker Network는 CKA 준비-2 포스팅을 참고 부탁드립니다.</p><h3 id=hello-world>Hello World</h3><p>GCP에서 제공하는 Cloud shell을 열어 Hello world 컨테이너를 실행합니다.</p><pre><code>docker run hello-world

&lt;--명령어 결과--&gt;
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
b8dfde127a29: Pull complete
Digest: sha256:9f6ad537c5132bcce57f7a0a20e317228d382c3cd61edae14650eec68b2b345c
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

</code></pre><p>이 컨테이너는 shell에 &ldquo;Hello from Docker!&ldquo;라는 메시지를 반환합니다. 결과는 간단하지만 결과가 나오기 전에 이미지를 불러오는 과정을 확인해봅시다.</p><p>로컬이미지에 Hello world이미지가 없기에 docker deamon은 docker hub라는 public registry에서 해당 이미지를 pull하여 컨테이너를 생성하고 실행하는 과정을 통해 위 메세지를 반환합니다.</p><p>docker hub에서 가져온 이미지를 확인해봅시다.</p><pre><code>docker images

&lt;--명령어 결과--&gt;
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    d1165f221234   3 months ago   13.3kB
</code></pre><p>여기서 알 수 있는 사실은 로컬에 이미지를 가지고 있지 않아도 docker deamon은 알아서 docker hub라는 public registry에서 이미지를 검색한다는 점입니다.</p><p>이미지를 로컬로 Pull하였기에 두번쨰 실행부터는 바로 로컬이미지를 통해 컨테이너를 생성, 실행할 수 있는 것 입니다.
위 이미지는 echo &ldquo;Hello from Docker!&ldquo;를 실행하고 사라졌네요 마치 k8s의 jobs같습니다. 실제로 Docker ps -a 를 통해 컨테이너를 확인해보면 컨테이너가 종료되었음을 알 수 있습니다.</p><pre><code>docker ps -a

&lt;--명령어 결과--&gt;
CONTAINER ID   IMAGE         COMMAND    CREATED              STATUS                          PORTS     NAMES
d36437eeb64a   hello-world   &quot;/hello&quot;   About a minute ago   Exited (0) About a minute ago             sweet_pare
359b95d41706   hello-world   &quot;/hello&quot;   2 minutes ago        Exited (0) 2 minutes ago                  happy_ritchie
</code></pre><p>docker run을 시작할때 옵션으로 &ndash;name을 주면 뒤에 무작위로 붙는 Names 라벨을 설정해줄 수 도 있습니다.</p><h3 id=dockerfile-build--run-test>DockerFile build / run Test</h3><p>Dockerfile을 통해 직접 이미지를 빌드할 수 있습니다. 간단하게 CentOS에 Httpd를 띄우는 Dockerfile을 작성합니다.</p><pre><code>cat &gt; Dockerfile &lt;&lt;EOF
# CentOS7를 사용합니다.
FROM centos:7

# 컨테이너에서 http 패키지를 설치해줍니다.
RUN yum -y install httpd 

# 현재 디렉토리의 내용을 컨테이너 내부로 복사합니다.
ADD /write-http.sh /write-http.sh

# 컨테이너에서 write-http.sh를 실행할 수있도록 권한을 변경합니다.
RUN chmod 755 /write-http.sh

# 서비스를 위해 컨테이너의 포트 80을 외부에 공개합니다.
EXPOSE 80

# 컨테이너가 시작될 때 write-http.sh 스크립트를 실행합니다.
ENTRYPOINT [&quot;sh&quot;,&quot;/etc/write-http.sh&quot;]

EOF
</code></pre><pre><code># write-http.sh 내용
#!/bin/sh
/usr/sbin/httpd -D FOREGROUND
</code></pre><p>이미지를 빌드하여 컨테이너에 띄워보면 아래와 같이 컨테이너가 생성됨을 알 수 있다.</p><pre><code>docker build -t dominic-web:0.1 .

&lt;--명령어 결과--&gt;
Sending build context to Docker daemon  3.072kB
Step 1/6 : FROM centos:7.5.1804
 ---&gt; cf49811e3cdb
Step 2/6 : RUN yum -y install httpd
 ---&gt; Using cache
 ---&gt; b04936c42e77
Step 3/6 : ADD /write-http.sh /write-http.sh
 ---&gt; 79d1a552ea2a
Step 4/6 : RUN chmod 755 /write-http.sh
 ---&gt; Running in 9041f099a392
Removing intermediate container 9041f099a392
 ---&gt; 96ce83e42fce
Step 5/6 : EXPOSE 80
 ---&gt; Running in eb46efbe7e84
Removing intermediate container eb46efbe7e84
 ---&gt; b39def1a021e
Step 6/6 : ENTRYPOINT [&quot;sh&quot;,&quot;/etc/write-http.sh&quot;]
 ---&gt; Running in 7e258ee5d665
Removing intermediate container 7e258ee5d665
 ---&gt; d3924f695483
Successfully built d3924f695483
Successfully tagged dominic-web:0.1
</code></pre><pre><code>docker images
&lt;--명령어 결과--&gt;
REPOSITORY    TAG        IMAGE ID       CREATED          SIZE
dominic-web   0.1        d3924f695483   40 seconds ago   353MB
</code></pre><p>이후 docker run command를 통해 이미지를 컨테이너에 실행시키면 된다.</p><pre><code>docker run -d -p 80:80 dominic-web:0.1
</code></pre><p>-d 옵션을 안주면 Foreground에서 동작하기에 쉘을 움직을 수가 없으니, -d 옵션으로 도커 컨테이너가 background에서 동작될 수 있도록 합시다!</p><p>만약 다른 버전의 이미지를 생성하고 싶다면 간단합니다. 그냥 빌드할때, 태그를 달리해주면 된다.</p><pre><code>docker build -t dominic-web:0.2 .
</code></pre><p>이후 빌드를하면 기존에 캐시되어있던 레이어는 넘어가고 변경사항이 생긴 레이어에서 수정이 발생함을 알 수 있을 것입니다.</p><h3 id=결과->결과 !</h3><p>curl로 확인해보니, httpd default page가 쫙~~나오네요. 다음엔 index.html을 좀 추가해야될듯 ㅎㅎ;</p><p>간단하게 docker 테스트 진행해봤다.</p><p>이후 docker push를 통해 내 GCR로 이미지를 푸쉬하는거까지 진행하였으나, 그부분은 Docs로 대체하겠다.</p><p><a href=https://cloud.google.com/container-registry/docs/pushing-and-pulling>이미지 내보내기</a></p></div><footer class=entry__footer><div class=entry__tags><a class="entry__tag btn" href=/tags/gcp/>gcp</a>
<a class="entry__tag btn" href=/tags/public-cloud/>public cloud</a></div></footer></article></div></main><div class="authorbox block"><div class=author><figure class=author__avatar><img class=author__img alt="Dominic avatar" src=/img/avatar.png height=90 width=90></figure><div class=author__body><div class=author__name>Dominic</div><div class=author__bio>Dominic's true identity is unknown. Maybe he is a cute fairy or slave :D</div></div></div></div><div class="related block"><h3 class=related__title>Related</h3><ul class=related__list><li class=related__item><a class=related__link href=/post/gcp/gcp_clb_1/>GCP-Cloud Load Balancer(1) 내용정리</a></li><li class=related__item><a class=related__link href=/post/gcp/gcp_clb_2/>GCP-Cloud Load Balancer(2) 테스트</a></li><li class=related__item><a class=related__link href=/post/gcp/gcp_vpc/>Network 기초(VPC) - GCP</a></li><li class=related__item><a class=related__link href=/post/gcp/gcp_issue/>아니 글쎄 갑자기 인스턴스가 죽었다니까요? - GCP</a></li><li class=related__item><a class=related__link href=/post/certificate/aws-saa/>AWSKRUG beginner group Study 관련</a></li></ul></div><section class="comments block"><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dominic"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><footer class=footer><div class="footer__social social"><a class=social__link target=_blank rel="noopener noreferrer" href=https://www.instagram.com/seob.199b><svg class="social__icon" aria-label="Instagram" role="img" width="32" height="32" viewBox="0 0 512 512"><g fill="none" stroke-width="29"><rect height="296" rx="78" width="296" x="108" y="108"/><circle cx="256" cy="256" r="69"/></g><circle cx="343" cy="169" r="19"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://linkedin.com/in/hanseob-lee-9655781aa><svg class="social__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://github.com/D0min1c><svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg></a></div><div class=footer__copyright>© 2021 Binario. <span class=footer__copyright-credits>Powered by <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/vimux/binario rel="nofollow noopener" target=_blank>Binario</a> theme.</span></div></footer><script src=/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script><script src=/js/custom.js></script></body></html>