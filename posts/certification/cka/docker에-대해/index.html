<!doctype html><html><head><title>Docker에 대해</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/favicon_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG><meta property="og:title" content="Docker에 대해"><meta property="og:description" content="Sample post with multiple images, embedded video ect."><meta property="og:type" content="article"><meta property="og:url" content="https://hugo-toha.github.io/posts/certification/cka/docker%EC%97%90-%EB%8C%80%ED%95%B4/"><meta property="article:published_time" content="2020-06-20T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-20T00:00:00+00:00"><meta name=description content="Sample post with multiple images, embedded video ect."><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-199142344-2','auto');ga('send','pageview');}</script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG alt=Logo>
255.255.248.0</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/>Certification</a><ul class=active><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/cka/>CKA</a><ul class=active><li><a class=active href=/posts/certification/cka/docker%EC%97%90-%EB%8C%80%ED%95%B4/ title="Docker에 대해">Docker에 대해</a></li><li><a href=/posts/certification/cka/k8scomponent/ title=k8s(component)>k8s(component)</a></li><li><a href=/posts/certification/cka/k8sgke%EC%82%AC%EC%9A%A9%EA%B8%B0/ title=k8s(GKE사용기)>k8s(GKE사용기)</a></li><li><a href=/posts/certification/cka/k8snetworking/ title=k8s(Networking)>k8s(Networking)</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/>Cloud</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/aws/>AWS</a><ul><li><a href=/posts/cloud/aws/awshost_issue/ title="서버가 갑자기 박살나셨습니다. -AWS">서버가 갑자기 박살나셨습니다. -AWS</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/gcp/>GCP</a><ul><li><a href=/posts/cloud/gcp/gcpissue/ title="서버가 갑자기 박살나셨습니다. -GCP">서버가 갑자기 박살나셨습니다. -GCP</a></li></ul></li></ul></li><li><a href=/posts/about_dominic/ title=😎About_dominic😎>😎About_dominic😎</a></li><li><a href=/posts/shortcodes/ title="Shortcodes Sample">Shortcodes Sample</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://hugo-toha.github.io/posts/certification/cka/docker%EC%97%90-%EB%8C%80%ED%95%B4/images/CKA_thumnail.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/dominic_hue8656283646074d0d4d459b13fee860e_56605_120x120_fit_box_2.png alt="Author Image"><h5 class=author-name>dominic</h5><p>June 20, 2020</p></div><div class=title><h1>Docker에 대해</h1></div><div class=post-content id=post-content><p>GCP 환경에서 docker를 사용하여 이미지를 빌드하고 실행해보고,</p><p>GCR(Google Container Registry)에 게시해봅시다.</p><h2 id=배경>배경</h2><p>Docker 컨테이너 빌드, 실행과 Docker Hub 및 Google Container Registry에서 Docker 이미지 가져오기</p><p>그리고 Dockerfile을 통해 이미지를 생성하는 법에 대해 간단하게 확인해봤습니다.</p><p>Docker Network는 k8s(Network) 포스팅을 참고 부탁드립니다.</p><h3 id=hello-world>Hello World</h3><p>GCP에서 제공하는 Cloud shell을 열어 Hello world 컨테이너를 실행합니다.</p><pre><code>docker run hello-world

&lt;--명령어 결과--&gt;
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
b8dfde127a29: Pull complete
Digest: sha256:9f6ad537c5132bcce57f7a0a20e317228d382c3cd61edae14650eec68b2b345c
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

</code></pre><p>이 컨테이너는 shell에 &ldquo;Hello from Docker!&ldquo;라는 메시지를 반환합니다. 결과는 간단하지만 결과가 나오기 전에 이미지를 불러오는 과정을 확인해봅시다.</p><p>로컬이미지에 Hello world이미지가 없기에 docker deamon은 docker hub라는 public registry에서 해당 이미지를 pull하여 컨테이너를 생성하고 실행하는 과정을 통해 위 메세지를 반환합니다.</p><p>docker hub에서 가져온 이미지를 확인해봅시다.</p><pre><code>docker images

&lt;--명령어 결과--&gt;
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    d1165f221234   3 months ago   13.3kB
</code></pre><p>여기서 알 수 있는 사실은 로컬에 이미지를 가지고 있지 않아도 docker deamon은 알아서 docker hub라는 public registry에서 이미지를 검색한다는 점입니다.</p><p>이미지를 로컬로 Pull하였기에 두번쨰 실행부터는 바로 로컬이미지를 통해 컨테이너를 생성, 실행할 수 있는 것 입니다.
위 이미지는 echo &ldquo;Hello from Docker!&ldquo;를 실행하고 사라졌네요 마치 k8s의 jobs같습니다. 실제로 Docker ps -a 를 통해 컨테이너를 확인해보면 컨테이너가 종료되었음을 알 수 있습니다.</p><pre><code>docker ps -a

&lt;--명령어 결과--&gt;
CONTAINER ID   IMAGE         COMMAND    CREATED              STATUS                          PORTS     NAMES
d36437eeb64a   hello-world   &quot;/hello&quot;   About a minute ago   Exited (0) About a minute ago             sweet_pare
359b95d41706   hello-world   &quot;/hello&quot;   2 minutes ago        Exited (0) 2 minutes ago                  happy_ritchie
</code></pre><p>docker run을 시작할때 옵션으로 &ndash;name을 주면 뒤에 무작위로 붙는 Names 라벨을 설정해줄 수 도 있습니다.</p><h3 id=dockerfile-build--run-test>DockerFile build / run Test</h3><p>Dockerfile을 통해 직접 이미지를 빌드할 수 있습니다. 간단하게 CentOS에 Httpd를 띄우는 Dockerfile을 작성합니다.</p><pre><code>cat &gt; Dockerfile &lt;&lt;EOF
# CentOS7를 사용합니다.
FROM centos:7

# 컨테이너에서 http 패키지를 설치해줍니다.
RUN yum -y install httpd 

# 현재 디렉토리의 내용을 컨테이너 내부로 복사합니다.
ADD /write-http.sh /write-http.sh

# 컨테이너에서 write-http.sh를 실행할 수있도록 권한을 변경합니다.
RUN chmod 755 /write-http.sh

# 서비스를 위해 컨테이너의 포트 80을 외부에 공개합니다.
EXPOSE 80

# 컨테이너가 시작될 때 write-http.sh 스크립트를 실행합니다.
ENTRYPOINT [&quot;sh&quot;,&quot;/etc/write-http.sh&quot;]

EOF
</code></pre><pre><code># write-http.sh 내용
#!/bin/sh
/usr/sbin/httpd -D FOREGROUND
</code></pre><p>이미지를 빌드하여 컨테이너에 띄워보면 아래와 같이 컨테이너가 생성됨을 알 수 있다.</p><pre><code>docker build -t dominic-web:0.1 .

&lt;--명령어 결과--&gt;
Sending build context to Docker daemon  3.072kB
Step 1/6 : FROM centos:7.5.1804
 ---&gt; cf49811e3cdb
Step 2/6 : RUN yum -y install httpd
 ---&gt; Using cache
 ---&gt; b04936c42e77
Step 3/6 : ADD /write-http.sh /write-http.sh
 ---&gt; 79d1a552ea2a
Step 4/6 : RUN chmod 755 /write-http.sh
 ---&gt; Running in 9041f099a392
Removing intermediate container 9041f099a392
 ---&gt; 96ce83e42fce
Step 5/6 : EXPOSE 80
 ---&gt; Running in eb46efbe7e84
Removing intermediate container eb46efbe7e84
 ---&gt; b39def1a021e
Step 6/6 : ENTRYPOINT [&quot;sh&quot;,&quot;/etc/write-http.sh&quot;]
 ---&gt; Running in 7e258ee5d665
Removing intermediate container 7e258ee5d665
 ---&gt; d3924f695483
Successfully built d3924f695483
Successfully tagged dominic-web:0.1
</code></pre><pre><code>docker images
&lt;--명령어 결과--&gt;
REPOSITORY    TAG        IMAGE ID       CREATED          SIZE
dominic-web   0.1        d3924f695483   40 seconds ago   353MB
</code></pre><p>이후 docker run command를 통해 이미지를 컨테이너에 실행시키면 된다.</p><pre><code>docker run -d -p 80:80 dominic-web:0.1
</code></pre><p>-d 옵션을 안주면 Foreground에서 동작하기에 쉘을 움직을 수가 없으니, -d 옵션으로 도커 컨테이너가 background에서 동작될 수 있도록 합시다!</p><p>만약 다른 버전의 이미지를 생성하고 싶다면 간단합니다. 그냥 빌드할때, 태그를 달리해주면 된다.</p><pre><code>docker build -t dominic-web:0.2 .
</code></pre><p>이후 빌드를하면 기존에 캐시되어있던 레이어는 넘어가고 변경사항이 생긴 레이어에서 수정이 발생함을 알 수 있을 것입니다.</p><h3 id=결과->결과 !</h3><p>curl로 확인해보니, httpd default page가 쫙~~나오네요. 다음엔 index.html을 좀 추가해야될듯 ㅎㅎ;</p><p>간단하게 docker 테스트 진행해봤다.</p><p>이후 docker push를 통해 내 GCR로 이미지를 푸쉬하는거까지 진행하였으나, 그부분은 Docs로 대체하겠다.</p><p><a href=https://cloud.google.com/container-registry/docs/pushing-and-pulling>이미지 내보내기</a></p></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#배경>배경</a><ul><li><a href=#hello-world>Hello World</a></li><li><a href=#dockerfile-build--run-test>DockerFile build / run Test</a></li><li><a href=#결과->결과 !</a></li></ul></li></ul></nav></div></div></section></div><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>