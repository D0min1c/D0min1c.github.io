<!doctype html><html><head><title>k8s(Ingress)</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/favicon_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG><meta property="og:title" content="k8s(Ingress)"><meta property="og:description" content="Sample post with multiple images, embedded video ect."><meta property="og:type" content="article"><meta property="og:url" content="https://hugo-toha.github.io/posts/certification/cka/k8singress/"><meta property="article:published_time" content="2021-06-29T00:00:00+00:00"><meta property="article:modified_time" content="2021-06-29T00:00:00+00:00"><meta name=description content="Sample post with multiple images, embedded video ect."><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-199142344-2','auto');ga('send','pageview');}</script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG alt=Logo>
255.255.248.0</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/>Certification</a><ul class=active><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/cka/>CKA</a><ul class=active><li><a href=/posts/certification/cka/k8scomponent/ title=k8s(component)>k8s(component)</a></li><li><a href=/posts/certification/cka/k8sgke%EC%82%AC%EC%9A%A9%EA%B8%B0-1/ title=k8s(GKE-Pod)>k8s(GKE-Pod)</a></li><li><a href=/posts/certification/cka/k8sgke%EC%82%AC%EC%9A%A9%EA%B8%B0-2/ title=k8s(GKE-Service)>k8s(GKE-Service)</a></li><li><a class=active href=/posts/certification/cka/k8singress/ title=k8s(Ingress)>k8s(Ingress)</a></li><li><a href=/posts/certification/cka/k8snetworking/ title=k8s(Networking)>k8s(Networking)</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/>Cloud</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/aws/>AWS</a><ul><li><a href=/posts/cloud/aws/awshost_issue/ title="AWSì´ìŠˆ (Host error)">AWSì´ìŠˆ (Host error)</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/gcp/>GCP</a><ul><li><a href=/posts/cloud/gcp/gcpissue/ title="GCP ì´ìŠˆ(ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ë“±)">GCP ì´ìŠˆ(ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ë“±)</a></li><li><a href=/posts/cloud/gcp/gcpnetwork-1/ title="GCP-VPC ê¸°ì´ˆ 1í¸">GCP-VPC ê¸°ì´ˆ 1í¸</a></li><li><a href=/posts/cloud/gcp/gcpnetwork-2/ title="GCP-VPC ê¸°ì´ˆ 2í¸">GCP-VPC ê¸°ì´ˆ 2í¸</a></li></ul></li></ul></li><li><a href=/posts/about_dominic/ title=ğŸ˜About_dominicğŸ˜>ğŸ˜About_dominicğŸ˜</a></li><li><a href=/posts/shortcodes/ title="Shortcodes Sample">Shortcodes Sample</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://hugo-toha.github.io/posts/certification/cka/k8singress/images/CKA_thumnail.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/dominic_hue8656283646074d0d4d459b13fee860e_56605_120x120_fit_box_2.png alt="Author Image"><h5 class=author-name>dominic</h5><p>June 29, 2021</p></div><div class=title><h1>k8s(Ingress)</h1></div><div class=post-content id=post-content><p>CKA ì·¨ë“ì„ ìœ„í•´ ì´ë¡ ì ìœ¼ë¡œ ê³µë¶€í•œ ë‚´ìš©ë“¤ì„ ê°„ë‹¨í•˜ê²Œ ê¸°ë¡í•˜ì˜€ìŠµë‹ˆë‹¤.</p><h3 id=ë°°ê²½>ë°°ê²½</h3><p>í…ŒìŠ¤íŠ¸ë¥¼ ëª‡ë²ˆ ì§„í–‰í•˜ë‹¤ê°€ Serviceì˜ LBì™€ Ingressì˜ ì°¨ì´ê°€ ì´í•´ë˜ì§€ ì•Šì•„ ëª‡ì ì ì–´ë´…ë‹ˆë‹¤.</p><h3 id=service-lb-vs-ingress>Service (LB) vs Ingress</h3><p>ìš°ì„  ë‘ê°€ì§€ ëª¨ë‘ ë‚´ íŒŒë“œ ì•ˆì— ë„ì›Œë†“ì€ ì»¨í…Œì´ë„ˆë“¤(ì• í”Œë¦¬ì¼€ì´ì…˜)ì„ ë…¸ì¶œí•˜ê³ ìí• ë•Œ ì‚¬ìš©í•˜ëŠ”ê²Œ ë§ë‹¤.
ì•ì„œ ì„¤ëª…í•˜ì˜€ë“¯ì´, Podì˜ ìƒíƒœëŠ” ë§¤ìš° ìœ ë™ì ì´ê¸°ì— ê³ ì •ì ì¸ IPë‚˜ Endpointê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ëŠ” ê²ƒ ë˜í•œ ë§ë‹¤.</p><p>ê·¸ëŸ¼ ì´ ë‘˜ì„ ì–´ë–»ê²Œ êµ¬ë¶„ì§€ìœ¼ë©´ ë ê¹Œ?
ê°ê° ì†ì„±ì„ ì•Œì•„ë³´ì.</p><h3 id=serviceì™€-ingress-êµ¬ë¶„>Serviceì™€ Ingress êµ¬ë¶„</h3><p>Serviceì™€ Ingress ëª¨ë‘ ë¶€í•˜ë¶„ì‚°ì²˜ë¦¬ë¥¼ í•œë‹¤ëŠ” ì ì€ ë™ì¼í•˜ë‹¤. ê°€ì¥ í° ì°¨ì´ëŠ” ì–´ë–»ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œí•˜ëŠëƒì´ë‹¤.</p><ol><li><p>LBì˜ ê²½ìš° : CSP(Cloud Service Provider)ì—ì„œ ì œê³µí•˜ëŠ” LBì„œë¹„ìŠ¤ê°€ í•„ìš”í•˜ë‹¤ ê°€ë ¹, AWSì˜ ELB, GCPì˜ GLBë“± Cloud Load Balancerì„ ì‚¬ìš©í•˜ê±°ë‚˜ ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œëŠ” metalLBì„ ì„¤ì¹˜í•˜ì—¬ì•¼ í•œë‹¤.
ì„œë¹„ìŠ¤ ë‹¹ 1ê°œì˜ public IPë¥¼ ë¶€ì—¬ë°›ì•„ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.</p></li><li><p>Ingressì˜ ê²½ìš° : ì„œë¹„ìŠ¤ë“¤ì˜ ìƒìœ„ ê°ì²´ ê°œë…ìœ¼ë¡œ URL mappingí•˜ì—¬ ìš”ì²­ì— ëŒ€í•œ ê²½ë¡œë¥¼ ì§€ì •í•´ì¤€ë‹¤.</p></li></ol><p>ê·¸ëŸ¬ë‹ˆê¹Œ ë¹„êµ ëŒ€ìƒì´ ë  ìˆ˜ ì—†ë‹¤.
LBëŠ” ì„œë¹„ìŠ¤ì§€ë§Œ IngressëŠ” ê·¸ëŸ° ì„œë¹„ìŠ¤ë“¤ì— ëŒ€í•´ ë¼ìš°íŒ…ì˜ ì—­í• ì„ ë‹´ë‹¹í•˜ê¸° ë•Œë¬¸ì— ìƒìœ„ ê°ì²´ë¡œ ì¸ì‹í•˜ë©´ ë ë“¯í•˜ë‹¤.</p><p>ê°„ë‹¨í•˜ê²Œ Ingress L7, Service LB L4 ì •ë„ë¡œ ..!</p><h3 id=í…ŒìŠ¤íŠ¸>í…ŒìŠ¤íŠ¸</h3><pre><code>kubectl create deployment hello-app --image=gcr.io/google-samples/hello-app:1.0
kubectl expose deployment hello-app  --port=8080.

kubectl get service
&lt;--ê²°ê³¼ê°’--&gt;
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
hello-app    ClusterIP   10.43.254.28   &lt;none&gt;        8080/TCP   6s
</code></pre><p>hello-app ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ê³  exposeí•˜ì—¬ ì„œë¹„ìŠ¤ë¡œ ë…¸ì¶œì‹œí‚¨ë‹¤.</p><h4 id=nginx-ì»¨íŠ¸ë¡¤ëŸ¬-ì‚¬ìš©>NGINX ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ìš©</h4><p><img src=images/ingress_1.jpg alt="This is an image"></p><p>NGINX ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì™¸ë¶€ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ ë…¸ì¶œë˜ì–´ì•¼ í•œë‹¤.
NGINX ì»¨íŠ¸ë¡¤ëŸ¬ ì„œë¹„ìŠ¤ ì¤‘ ì„œë¹„ìŠ¤ type: LoadBalancerë¥¼ ì‚¬ìš©í•˜ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆë‹¤.</p><pre><code>helm install nginx-ingress stable/nginx-ingress --set rbac.create=true

kubectl get service
&lt;--ê²°ê³¼ê°’--&gt;
NAME                            TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE
hello-app                       ClusterIP      10.43.254.28    &lt;none&gt;          8080/TCP                     3m28s
kubernetes                      ClusterIP      10.43.240.1     &lt;none&gt;          443/TCP                      7m10s
nginx-ingress-controller        LoadBalancer   10.43.246.253   34.132.63.140   80:32210/TCP,443:30476/TCP   54s
nginx-ingress-default-backend   ClusterIP      10.43.248.107   &lt;none&gt;          80/TCP                       54s
</code></pre><ul><li>nginx-ingress-default-backend : ëª¨ë“  URL ê²½ë¡œë¥¼ ì²˜ë¦¬í•˜ê³  NGINX ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ìŠ¤íŠ¸í•˜ëŠ” ì„œë¹„ìŠ¤ì´ë‹¤.
ì„œë¹„ìŠ¤ì— ì •ìƒì ìœ¼ë¡œ Nginx Ingress ê°€ ë°°í¬ëœ ê²ƒì„ í™•ì¸í—€ë‹¤ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê²½ë¡œ ê·œì¹™ì„ ì •ì˜í•´ë³´ì.</li></ul><pre><code>apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: ingress-resource
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/ssl-redirect: &quot;false&quot;
spec:
  rules:
  - http:
      paths:
      - path: /hello
        backend:
          serviceName: hello-app
          servicePort: 8080
</code></pre><p>ê°„ë‹¨í•˜ê²Œ 34.132.63.140/helloì— ëŒ€í•œ ìš”ì²­ì„ ë°±ì—”ë“œì˜ hello-appì„œë¹„ìŠ¤ì˜ 8080ìœ¼ë¡œ ìš”ì²­ì„ í˜ë ¤ì£¼ëŠ” ì¸ê·¸ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•´ë³´ì•˜ë‹¤.
ì ìš© í•´ë³´ì</p><pre><code>kubectl apply -f ingress-resource.yaml
kubectl get ingress ingress-resource
</code></pre><p>ì´ì œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¥¼ í™•ì¸í•´ë³´ì.</p><p><strong>ì •ìƒê²½ë¡œ ì ‘ê·¼ ì‹œ ê²°ê³¼</strong>
<img src=images/test_1.jpg alt="This is an image"></p><p><strong>ë‹¤ë¥¸ê²½ë¡œ ì ‘ê·¼ ì‹œ ê²°ê³¼ (default backend ë™ì‘ í™•ì¸)</strong>
<img src=images/test_2.jpg alt="This is an image"></p><p>ê°„ë‹¨í•˜ê²Œ LBì™€ Ingressì˜ ì°¨ì´ë¥¼ í™•ì¸í•´ë³´ì•˜ë‹¤.</p></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#ë°°ê²½>ë°°ê²½</a></li><li><a href=#service-lb-vs-ingress>Service (LB) vs Ingress</a></li><li><a href=#serviceì™€-ingress-êµ¬ë¶„>Serviceì™€ Ingress êµ¬ë¶„</a></li><li><a href=#í…ŒìŠ¤íŠ¸>í…ŒìŠ¤íŠ¸</a><ul><li><a href=#nginx-ì»¨íŠ¸ë¡¤ëŸ¬-ì‚¬ìš©>NGINX ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ìš©</a></li></ul></li></ul></li></ul></nav></div></div></section></div><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>