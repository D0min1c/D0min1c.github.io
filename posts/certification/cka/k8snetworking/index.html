<!doctype html><html><head><title>k8s(Networking)</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/favicon_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG><meta property="og:title" content="k8s(Networking)"><meta property="og:description" content="Sample post with multiple images, embedded video ect."><meta property="og:type" content="article"><meta property="og:url" content="https://hugo-toha.github.io/posts/certification/cka/k8snetworking/"><meta property="article:published_time" content="2020-06-19T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-19T00:00:00+00:00"><meta name=description content="Sample post with multiple images, embedded video ect."><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-199142344-2','auto');ga('send','pageview');}</script></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG alt=Logo>
255.255.248.0</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/site/main-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu1d79931af21da1953430965fd067c561_13812_42x0_resize_q75_box.JPG class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/>Certification</a><ul class=active><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/certification/cka/>CKA</a><ul class=active><li><a href=/posts/certification/cka/docker%EC%97%90-%EB%8C%80%ED%95%B4/ title="Dockerì— ëŒ€í•´">Dockerì— ëŒ€í•´</a></li><li><a href=/posts/certification/cka/k8scomponent/ title=k8s(component)>k8s(component)</a></li><li><a href=/posts/certification/cka/k8sgke%EC%82%AC%EC%9A%A9%EA%B8%B0/ title=k8s(GKEì‚¬ìš©ê¸°)>k8s(GKEì‚¬ìš©ê¸°)</a></li><li><a class=active href=/posts/certification/cka/k8snetworking/ title=k8s(Networking)>k8s(Networking)</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/>Cloud</a><ul><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/aws/>AWS</a><ul><li><a href=/posts/cloud/aws/awshost_issue/ title="AWSì´ìŠˆ (Host error)">AWSì´ìŠˆ (Host error)</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/cloud/gcp/>GCP</a><ul><li><a href=/posts/cloud/gcp/gcpissue/ title="GCP ì´ìŠˆ(ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ë“±)">GCP ì´ìŠˆ(ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ë“±)</a></li><li><a href=/posts/cloud/gcp/gcpnetwork-1/ title="GCP-VPC ê¸°ì´ˆ 1í¸">GCP-VPC ê¸°ì´ˆ 1í¸</a></li></ul></li></ul></li><li><a href=/posts/about_dominic/ title=ğŸ˜About_dominicğŸ˜>ğŸ˜About_dominicğŸ˜</a></li><li><a href=/posts/shortcodes/ title="Shortcodes Sample">Shortcodes Sample</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://hugo-toha.github.io/posts/certification/cka/k8snetworking/images/CKA_thumnail.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/dominic_hue8656283646074d0d4d459b13fee860e_56605_120x120_fit_box_2.png alt="Author Image"><h5 class=author-name>dominic</h5><p>June 19, 2020</p></div><div class=title><h1>k8s(Networking)</h1></div><div class=post-content id=post-content><p>CKA ì·¨ë“ì„ ìœ„í•´ ì´ë¡ ì ìœ¼ë¡œ ê³µë¶€í•œ ë‚´ìš©ë“¤ì„ ê°„ë‹¨í•˜ê²Œ ê¸°ë¡í•˜ì˜€ìŠµë‹ˆë‹¤.</p><h2 id=ë°°ê²½>ë°°ê²½</h2><p>ì»¨í…Œì´ë„ˆ Networkë¶€í„° Pod Networkê¹Œì§€ ì´ë¡ ì •ë¦¬</p><h3 id=docker-networking>Docker Networking</h3><ul><li>ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ëŠ” í•˜ë‚˜ì˜ <strong>í”„ë¡œì„¸ìŠ¤</strong></li><li>ìœ„ì—ì„œ ê²©ë¦¬ëœ í™˜ê²½ì„ êµ¬í˜„í•˜ëŠ” ê¸°ìˆ ì€ chroot, cgroups, namespace<ul><li>namespace : ë„¤íŠ¸ì›Œí¬ì¸í„°í˜ì´ìŠ¤, ë¼ìš°íŒ…, ë°©í™”ë²½ ê·œì¹™ë“¤ì„ ê²©ë¦¬í•œë‹¤. ì´ëŸ° namespaceë¡œ ì¸í•´ ê²©ë¦¬ëœ PIDë“¤ì€ vethë¥¼ í†µí•´ ì—°ê²°í•œë‹¤.</li><li>veth : linked virtual ethernet device pair = í•­ìƒ ìŒ (pair)ë¡œ ìƒì„±ë˜ì–´ ì—°ê²°ëœ ìƒíƒœë¥¼ ìœ ì§€í•œë‹¤.</li></ul></li></ul><p>ì§ì ‘ Namespaceë¥¼ ìƒì„±í•´ë³´ì.</p><p><img src=images/ns_1.jpg alt="This is an image"></p><p>local namespaceì™€ ipnetns addë¥¼ í†µí•´ ë§Œë“  namespaceì— vethë¥¼ ë¶™ì—¬ë´¤ë‹¤.</p><p>ì»¨í…Œì´ë„ˆë¥¼ ìƒˆë¡œì´ ë°°í¬í• ë•Œë§ˆë‹¤ ì»¨í…Œì´ë„ˆì—ê²Œ veth0ë¼ëŠ” ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ í• ë‹¹í•˜ì—¬ docker0ì— ì—°ê²°,
linked virtual ethernet device pairë¡œ ì»¨í…Œì´ë„ˆì™€ bridgeë¥¼ ì—°ê²°í•œë‹¤.</p><p><img src=images/docker_info.jpg alt="This is an image"></p><ul><li>ë„ì»¤ ì„¤ì¹˜ ì§í›„ ìƒíƒœ</li></ul><h4 id=bridge-network>bridge Network</h4><p>ê²°êµ­ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ (Namesapce ë‚´ veth)ë“¤ì€ bridge(docker0 : docker ì‹œì‘ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” bridge)ë¥¼ í†µí•´ ì—°ê²°ë˜ì–´ í•˜ë‚˜ì˜ ì„¸ê·¸ë¨¼íŠ¸ë¡œ êµ¬ì„±ë˜ì§€ë§Œ, ê°™ì€ bridgeì— ì—°ê²°ë˜ì§€ ì•Šì€ ì»¨í…Œì´ë„ˆë“¤ì€ ê²©ë¦¬ëœ ê³µê°„ì„ ìœ ì§€í•œë‹¤.</p><p><strong>[eth0 -> docker0(bridge) -> veth0(host) &lt;-[pairing]-> veth0(container) -> container]</strong></p><p><img src=images/docker_brg.jpg alt="This is an image"></p><p>ìœ„ ì´ë¯¸ì§€ì—ì„œ bridgeì˜ subnetê³¼ Gatewayë¥¼ ë³´ê³  ë°‘ì— containerì˜ IPë¥¼ ë³´ë©´ í™•ì‹¤í•˜ë‹¤.</p><p>ì•„ë‹ˆë©´ brctl show ëª…ë ¹ì–´ë¥¼ í†µí•´ bridgeì— ì—°ê²°ë˜ì–´ìˆëŠ” Interfaceì— vethë¥¼ í™•ì¸í•˜ë©´ ëœë‹¤.</p><p>default bridge ë§ê³ , custom bridgeë¥¼ ìƒì„±í•˜ì—¬ ë³„ë„ì˜ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ë„ ë¬¼ë¡  ê°€ëŠ¥í•˜ë‹¤ê³  í•˜ì§€ë§Œ, í•´ë³´ì§„ ì•Šì•˜ìœ¼ë¯€ë¡œ ì ì‹œ ë¯¸ë¤„ë‘ê² ë‹¤.</p><h4 id=host-networking>Host Networking</h4><p><img src=images/docker_hst.jpg alt="This is an image"></p><p>Hostì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ê·¸ëŒ€ë¡œ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•œë‹¤.</p><p>ê·¸ë ‡ê¸° ë–„ë¬¸ì— ì»¨í…Œì´ë„ˆì— IP(veth)ë¥¼ í• ë‹¹í•˜ì§€ ì•Šê¸°ì— bridgeì— ë°”ì¸ë”©ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.</p><h4 id=overlay-networking>overlay Networking</h4><p>ë‹¤ë¥¸ ë„ì»¤ ë°ëª¬ hostì˜ containerì™€ í†µì‹ í•˜ê¸° ìœ„í•´ ë³´í†µ OSë ˆë²¨ì—ì„œì˜ ë¼ìš°íŒ…ì´ í•„ìš”í•˜ì§€ë§Œ, Overlay ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶„ì‚° ë„¤íŠ¸ì›Œí¬(arg. Swarm service)ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.</p><h4 id=none-networking>none Networking</h4><p>none : ëª¨ë“  ë„¤íŠ¸ì›Œí‚¹ ë“œë¼ì´ë²„, ê·¸ ì–´ë– í•œ ì¸í„°í˜ì´ìŠ¤ë„ ì—†ëŠ” ì„¤ì •ì´ë‹¤. ë³´í†µ ì»¤ìŠ¤í…€ ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ë¥¼ êµ¬ì„±í•  ê²½ìš° ì‚¬ìš©í•œë‹¤.</p><h4 id=macvlan-ipvlan-networking>macvlan, ipvlan Networking</h4><p>ë§ê·¸ëŒ€ë¡œ ê°€ìƒ macì£¼ì†Œë¥¼ í• ë‹¹í•˜ì—¬ ë¬¼ë¦¬ì  í˜¸ìŠ¤íŠ¸ì²˜ëŸ¼ ë³´ì´ë„ë¡ ì„¤ì •í•˜ê±°ë‚˜, L2,L3 ëª¨ë“œê°€ í•„ìš”í•  ë•Œ ì‚¬ìš©í•œë‹¤.</p><h3 id=k8s-networking>k8s Networking</h3><h4 id=pod-networking>Pod Networking</h4><p>Container Networkì—ì„œ ì„¤ëª…í–ˆë“¯ì´, ê°ê°ì˜ ì»¨í…Œì´ë„ˆëŠ” ë…ë¦½ì ì¸ namesapceë¥¼ í†µí•´ ê²©ë¦¬ë˜ì–´ì§„ë‹¤.</p><p>ì—¬ê¸°ì„œ k8sì˜ Podsì˜ ê°œë…ì´ ë“¤ì–´ê°€ë©´ ê°™ì€ podì˜ ì»¨í…Œì´ë„ˆë“¤ì€ Network namespaceë¥¼ ê³µìœ í•œë‹¤.(ì»¨í…Œì´ë„ˆê°€ Nê°œì—¬ë„ vethëŠ” 1ê°œ) ê·¸ë ‡ê¸°ì— ë™ì¼í•œ IPë¥¼ ì‚¬ìš©í•œë‹¤.</p><p>ë”°ë¼ì„œ lookback ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ localhost+port í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.</p><p>ì´ Pod ë‚´ ì»¨í…Œì´ë„ˆë“¤ì˜ Namespaceë¥¼ ê³µìœ í•´ì£¼ëŠ”ê²Œ ë°”ë¡œ pause ì»¨í…Œì´ë„ˆì´ë‹¤.</p><p>CNIë¥¼ ì–´ë–¤ê±¸ ì„ íƒí•´ëŠ”ì§€ì— ë”°ë¼ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ê³¼ ì„±ëŠ¥ì´ ë‹¬ë¼ì§€ê¸°ì— Pods Networkê¹Œì§€ë§Œ ì •ë¦¬í•´ë†“ëŠ”ë‹¤.</p></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#ë°°ê²½>ë°°ê²½</a><ul><li><a href=#docker-networking>Docker Networking</a><ul><li><a href=#bridge-network>bridge Network</a></li><li><a href=#host-networking>Host Networking</a></li><li><a href=#overlay-networking>overlay Networking</a></li><li><a href=#none-networking>none Networking</a></li><li><a href=#macvlan-ipvlan-networking>macvlan, ipvlan Networking</a></li></ul></li><li><a href=#k8s-networking>k8s Networking</a><ul><li><a href=#pod-networking>Pod Networking</a></li></ul></li></ul></li></ul></nav></div></div></section></div><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>